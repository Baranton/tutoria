<h3 class="dashboard-title">Welcome back <span class="dashboard-user"><%= @user.first_name%></span></h3>

<div class="dashboard-container">
  <div class="row">

    <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1" >
    </div>

    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5" >
      <div class="dashboard-left">

        <div class="dashboard-tutorials">
          <h5>Tutorials</h5>

          <ul>
            <% @tutorials.each do |tutorial| %>
              <span></span><li><strong><%= tutorial.product %></strong> - <%= tutorial.title %></li>
              <%= link_to "View", company_tutorial_path(tutorial.company.id, tutorial.id), class: "btn btn-outline-primary"%> |
              <%#= link_to "Edit", edit_company_tutorial_path(tutorial.company.id, tutorial.id)%>
              <%# if @user.status == "manager" %>
              | <%#= link_to "Delete", company_tutorial_path(tutorial.company.id, tutorial.id), method: :delete%></span>
              <%# end %>
            <% end %>

        </ul>

        </div>
      </div>
    </div>

    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5">
      <div class="dashboard-right">

        <div class="dashboard-staff">
          <h5>Team</h5>

          <ul>
            <% @staff.each do |staff| %>
              <li><%= staff.first_name %> <%= staff.last_name %> - <%= staff.status %>

                <% if @user.status == "manager" %>
                  <% if staff.status == "staff" %>
                    <%= link_to "Upgrade", company_make_manager_path(@company.id, staff.id), method: :patch, class: "btn btn-outline-primary" %>
                    <% if staff.id != @user.id && staff.status == "staff"%>
                      <%= link_to "Delete", company_user_path(@company.id, staff.id), method: :delete, class: "btn btn-outline-danger" %>
                  <% end %>
                <% end %>
              </li>
              <% end %>
            <% end %>
        </ul>

        </div>

       <div class="dashboard-tutorials-actions">
            <h5>Actions</h5>


          <%= link_to "New tutorial", root_path, class: "btn btn-outline-primary" %><br>

          <% if @user.status == "manager" %>
            <%= link_to "New team member", new_user_invitation_path(:user), class: "btn btn-outline-success" %><br>
          <% end %>
          <!--
          <div class="dashboard-action">
            <i class="fas fa-chart-line"></i> <%= link_to "Analytics" %><br>
          </div>
          -->
        </div>

      </div>
    </div>

    <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1" >
    </div>

  </div>

  <div class="row">
      <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1" >
      </div>

      <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10" >
        <div class="dashboard-questions">
            <h5>Open questions</h5>

            <ol>
              <% @tutorials.each do |tutorial| %>
                <% if tutorial.questions.exists? %>
                  <% questions = tutorial.questions %>
                  <% step_start_times = tutorial.steps.map {|step| step.start_time } %>
                  <li> <%= tutorial.title %></li>
                  <% questions.each do |question| %>
                    <% if !question.answered %>
                      <ul>
                        <li> Step: <%= "#{step_start_times.find_index(question.step.start_time) + 1}" %> </li>
                        <p class="dashboard-tutorial-questions"> <%= question.content %> </p>
                        <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#exampleModalCenter">Answer</button>
                        <%= link_to "Delete", question_path(question.id), method: :delete, class: "btn btn-outline-danger" %>
                      </ul>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            </ol>


          </div>
      </div>

        <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1" >
      </div>
  </div>


</div>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Answer question</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form class="simple_form new_question" id="new_question" novalidate="novalidate" action="/step/3/questions" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="âœ“"><input type="hidden" name="authenticity_token" value="mpAGFQzlet+3Jjw6mMY8fpLyXXhhKm0ZtDL8EiFpLMtKICrmp9JEbM1t6K9LgQgO5iVUMHva1A5+gKdvp/c0KA==">
          <textarea label="Your question" placeholder="Please type your question here" rows="5" cols="50" name="question[content]" id="question_content"></textarea>

          <input type="submit" name="commit" value="Submit" class="btn btn btn-primary" data-disable-with="Submit">
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
